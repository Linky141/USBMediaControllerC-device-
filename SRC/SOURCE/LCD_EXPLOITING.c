#include "../HEADERS/LCD_EXPLOITING.h"

void LCDEXPLOITING_SetLctBrightness(int val) {
	if (val < 0 || val > 100)
		return;
	int tmp = 100 - val;
	PWM_SetDutyCycle(1, tmp);
}

void screen_show_initialize(struct LCDEXPLOITING_AllPages *lcdPageLabbles,
		struct SettingsMenu_values *settinsgMenu_values) {
	LCD_Clear();
	LCD_XYPrintf(3, 0, "Waiting for");
	LCD_XYPrintf(5, 1, "labels");
	LedControl_OFF(500);
	LCDEXPLOITING_SetLctBrightness(0);
	UART_Printf("RTW!\n");
	UARTCOMMUNICATION_recive(lcdPageLabbles->page1.field1);
	LCDEXPLOITING_SetLctBrightness(settinsgMenu_values->pwmBrightness);
	DrawLoading(11, 1, lcdPageLabbles->page1.field1,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page1.field2);
	DrawLoading(12, 2, lcdPageLabbles->page1.field2,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page1.field3);
	DrawLoading(13, 3, lcdPageLabbles->page1.field3,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page1.field4);
	DrawLoading(14, 4, lcdPageLabbles->page1.field4,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page2.field1);
	DrawLoading(21, 5, lcdPageLabbles->page2.field1,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page2.field2);
	DrawLoading(22, 6, lcdPageLabbles->page2.field2,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page2.field3);
	DrawLoading(23, 7, lcdPageLabbles->page2.field3,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page2.field4);
	DrawLoading(24, 8, lcdPageLabbles->page2.field4,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page3.field1);
	DrawLoading(31, 9, lcdPageLabbles->page3.field1,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page3.field2);
	DrawLoading(32, 10, lcdPageLabbles->page3.field2,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page3.field3);
	DrawLoading(33, 11, lcdPageLabbles->page3.field3,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page3.field4);
	DrawLoading(34, 12, lcdPageLabbles->page3.field4,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page4.field1);
	DrawLoading(41, 13, lcdPageLabbles->page4.field1,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page4.field2);
	DrawLoading(42, 14, lcdPageLabbles->page4.field2,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page4.field3);
	DrawLoading(43, 15, lcdPageLabbles->page4.field3,
			settinsgMenu_values->debugMode);
	UARTCOMMUNICATION_recive(lcdPageLabbles->page4.field4);
	DrawLoading(44, 16, lcdPageLabbles->page4.field4,
			settinsgMenu_values->debugMode);
	_delay_ms(500);
	LCD_Clear();
	LCD_XYPrintf(0, 0, "initialization");
	LCD_XYPrintf(0, 1, "completed");
	if (settinsgMenu_values->ledStatus) {
		LedControl_OFF(125);
		LedControl_ON(125);
		LedControl_OFF(125);
		LedControl_ON(125);
		LedControl_OFF(125);
		LedControl_ON(125);
		LedControl_OFF(125);
		LedControl_ON(125);
		LedControl_OFF(200);
	}
	else
		DELAY_ms(1200);
	LCD_Clear();
}

void LCDEXPLOITING_showPage(int page,
		struct LCDEXPLOITING_AllPages *lcdPageLabbles) {
	LCD_Clear();
	int space;
	if (page == 1) {
		LCD_XYPrintf(0, 0, "%s", lcdPageLabbles->page1.field1);
		space = LCDEXPLOITING_howLong(lcdPageLabbles->page1.field2);
		LCD_XYPrintf((9 + space), 0, "%s", lcdPageLabbles->page1.field2);
		LCD_XYPrintf(0, 1, "%s", lcdPageLabbles->page1.field3);
		space = LCDEXPLOITING_howLong(lcdPageLabbles->page1.field4);
		LCD_XYPrintf((9 + space), 1, "%s", lcdPageLabbles->page1.field4);
	}
	else if (page == 2) {
		LCD_XYPrintf(0, 0, "%s", lcdPageLabbles->page2.field1);
		space = LCDEXPLOITING_howLong(lcdPageLabbles->page2.field2);
		LCD_XYPrintf((9 + space), 0, "%s", lcdPageLabbles->page2.field2);
		LCD_XYPrintf(0, 1, "%s", lcdPageLabbles->page2.field3);
		space = LCDEXPLOITING_howLong(lcdPageLabbles->page2.field4);
		LCD_XYPrintf((9 + space), 1, "%s", lcdPageLabbles->page2.field4);
	}
	else if (page == 3) {
		LCD_XYPrintf(0, 0, "%s", lcdPageLabbles->page3.field1);
		space = LCDEXPLOITING_howLong(lcdPageLabbles->page3.field2);
		LCD_XYPrintf((9 + space), 0, "%s", lcdPageLabbles->page3.field2);
		LCD_XYPrintf(0, 1, "%s", lcdPageLabbles->page3.field3);
		space = LCDEXPLOITING_howLong(lcdPageLabbles->page3.field4);
		LCD_XYPrintf((9 + space), 1, "%s", lcdPageLabbles->page3.field4);
	}
	else if (page == 4) {
		LCD_XYPrintf(0, 0, "%s", lcdPageLabbles->page4.field1);
		space = LCDEXPLOITING_howLong(lcdPageLabbles->page4.field2);
		LCD_XYPrintf((9 + space), 0, "%s", lcdPageLabbles->page4.field2);
		LCD_XYPrintf(0, 1, "%s", lcdPageLabbles->page4.field3);
		space = LCDEXPLOITING_howLong(lcdPageLabbles->page4.field4);
		LCD_XYPrintf((9 + space), 1, "%s", lcdPageLabbles->page4.field4);
	}

}

int LCDEXPLOITING_howLong(char *chars) {
	int size = 0;
	int specialSymbols = 0;
	for (int clk = 0; chars[clk] != '\0'; clk++) {
		size++;
		if (chars[clk] == '%')
			specialSymbols++;
	}
	return ((7 - size) + specialSymbols);
}

void LCDEXPLOITING_DrawLoading(int length) {
	for (int clk = 0; clk < length; clk++) {
		LCD_XYPrintf(clk, 1, "%?");
	}
}

void DrawLoading(int pagefield, int loadingPorgress, const char *lbl,
bool debugMode) {
	LCD_Clear();
	if (debugMode == 1)
		LCD_XYPrintf(0, 0, "%d:%s", pagefield, lbl);
	else
		LCD_XYPrintf(0, 0, "Please wait");
	LCDEXPLOITING_DrawLoading(loadingPorgress);
}
